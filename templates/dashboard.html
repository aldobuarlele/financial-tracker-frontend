<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8">
    <title>Financial Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-dark bg-primary mb-4">
      <div class="container d-flex justify-content-between">
        <span class="navbar-brand mb-0 h1">üí∞ Financial Tracker</span>
        <div class="d-flex align-items-center">
          <span class="text-white me-3">Halo, {{ username }}</span>
          <a href="/logout" class="btn btn-sm btn-danger">Logout</a>
        </div>
      </div>
    </nav>
    <div class="container">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="d-flex align-items-center gap-3">
          <h2 class="mb-0">Dashboard Keuangan</h2>
          <a href="/kalender" class="btn btn-outline-primary btn-sm">üìÖ Lihat Kalender</a>
          <a href="/statistik" class="btn btn-outline-dark btn-sm">üìä Laporan</a>
        </div>
        <div class="d-flex gap-2">
          <a href="/tambah?mode=INCOME" class="btn btn-success btn-lg shadow-sm">+ Pemasukan</a>
          <a href="/tambah?mode=EXPENSE" class="btn btn-danger btn-lg shadow-sm">- Pengeluaran</a>
        </div>
      </div>
      <div class="alert alert-info shadow-sm d-flex justify-content-between align-items-center">
        <span class="fs-5">Total Kekayaan Bersih:</span>
        <strong class="fs-3">Rp {{ "{:,.0f}".format(total_saldo).replace(',', '.') }}</strong>
      </div>
      <div class="row mb-4"> {% for wallet in wallets %} <div class="col-md-4">
          <div class="card shadow-sm mb-3 border-0 h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <h5 class="card-title mb-0">{{ wallet.walletName }}</h5>
                <span class="badge bg-light text-dark border">{{ wallet.walletType }}</span>
              </div>
              <h3 class="text-success mt-3 mb-0"> Rp {{ "{:,.0f}".format(wallet.balance).replace(',', '.') }}
              </h3>
            </div>
          </div>
        </div> {% endfor %} </div>
      <div class="row">
        <div class="col-md-8 mb-4">
          <h4 class="mb-3">Riwayat Transaksi</h4>
          <div class="card shadow-sm border-0">
            <div class="card-body p-0">
              <table class="table table-hover mb-0 align-middle">
                <thead class="table-dark">
                  <tr>
                    <th class="ps-3">Tanggal</th>
                    <th>Kategori</th>
                    <th>Ket</th>
                    <th class="text-end pe-3">Jumlah</th>
                    <th style="width: 50px;"></th>
                  </tr>
                </thead>
                <tbody> {% for t in transactions %} <tr>
                    <td class="ps-3 text-muted small">{{ t.transactionDate[:10] }}</td>
                    <td> {% if t.category %} <span class="badge bg-secondary">{{ t.category.name }}</span> {% else %} <span class="badge bg-light text-dark">-</span> {% endif %} </td>
                    <td>{{ t.description }}</td>
                    <td class="text-end pe-3 {{ 'text-success fw-bold' if t.transactionType == 'INCOME' else 'text-danger fw-bold' }}">
                      {{ "+" if t.transactionType == 'INCOME' else "-" }} Rp {{ "{:,.0f}".format(t.amount).replace(',', '.') }}
                    </td>
                    <td class="text-center d-flex gap-1 justify-content-end">
                      <a href="/edit/{{ t.id }}" class="btn btn-sm btn-outline-warning border-0" title="Edit"> ‚úèÔ∏è </a>
                      <form action="/hapus/{{ t.id }}" method="POST" onsubmit="...">
                        <button type="submit" class="btn btn-sm btn-outline-danger border-0">üóëÔ∏è</button>
                      </form>
                    </td>
                  </tr> {% else %} <tr>
                    <td colspan="5" class="text-center py-4 text-muted">Belum ada transaksi. Yuk catat sekarang!</td>
                  </tr> {% endfor %} </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <h4 class="mb-3">Analisis Pengeluaran</h4>
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <canvas id="expenseChart"></canvas> {% if not chart_values %} <p class="text-center text-muted mt-5 mb-5">Belum ada data pengeluaran.</p> {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="mb-5"></div>
    <script>
      const ctx = document.getElementById('expenseChart');
      const labels = {
        {
          chart_labels | tojson
        }
      };
      const data = {
        {
          chart_values | tojson
        }
      };
      if (data.length > 0) {
        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [{
              label: 'Total Pengeluaran (Rp)',
              data: data,
              backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'],
              hoverOffset: 4
            }]
          },
          options: {
            plugins: {
              legend: {
                position: 'bottom'
              }
            }
          }
        });
      }
    </script>
  </body>
</html>