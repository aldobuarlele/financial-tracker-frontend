<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Financial Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

    <nav class="navbar navbar-dark bg-primary mb-4">
        <div class="container d-flex justify-content-between">
            <span class="navbar-brand mb-0 h1">ðŸ’° Financial Tracker</span>
            
            <div class="d-flex align-items-center">
                <span class="text-white me-3">Halo, {{ username }}</span>
                <a href="/logout" class="btn btn-sm btn-danger">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Dashboard Keuangan</h2>
            <a href="/tambah" class="btn btn-primary btn-lg">+ Catat Transaksi</a>
        </div>
        
        <div class="alert alert-info">
            Total Kekayaan: <strong>Rp {{ "{:,.0f}".format(total_saldo) }}</strong>
        </div>

        <div class="row mb-4">
            {% for wallet in wallets %}
            <div class="col-md-4">
                <div class="card shadow-sm mb-3">
                    <div class="card-body">
                        <h5 class="card-title">{{ wallet.walletName }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">{{ wallet.walletType }}</h6>
                        <h3 class="text-success mt-3">
                            Rp {{ "{:,.0f}".format(wallet.balance) }}
                        </h3>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="row">
            
            <div class="col-md-8">
                <h4 class="mb-3">Riwayat Transaksi</h4>
                <div class="card shadow-sm">
                    <div class="card-body p-0">
                        <table class="table table-striped mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Kategori</th>
                                    <th>Ket</th>
                                    <th>Jumlah</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for t in transactions %}
                                <tr>
                                    <td>{{ t.transactionDate[:10] }}</td> 
                                    <td>
                                        {% if t.category %}
                                            <span class="badge bg-secondary">{{ t.category.name }}</span>
                                        {% else %}
                                            <span class="badge bg-light text-dark">-</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ t.description }}</td>
                                    <td class="{{ 'text-success fw-bold' if t.transactionType == 'INCOME' else 'text-danger fw-bold' }}">
                                        {{ "+" if t.transactionType == 'INCOME' else "-" }} 
                                        Rp {{ "{:,.0f}".format(t.amount) }}
                                    </td>
                                </tr>
                                {% else %}
                                <tr><td colspan="4" class="text-center py-3">Kosong</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <h4 class="mb-3">Analisis Pengeluaran</h4>
                <div class="card shadow-sm">
                    <div class="card-body">
                        <canvas id="expenseChart"></canvas>
                        
                        {% if not chart_values %}
                            <p class="text-center text-muted mt-5">Belum ada data pengeluaran.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

        </div>
    </div>
    
    <div class="mb-5"></div>

    <script>
        const ctx = document.getElementById('expenseChart');

        // Terima data dari Python
        const labels = {{ chart_labels | tojson }};
        const data = {{ chart_values | tojson }};

        if (data.length > 0) {
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Pengeluaran (Rp)',
                        data: data,
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
                        ],
                        hoverOffset: 4
                    }]
                }
            });
        }
    </script>

</body>
</html>